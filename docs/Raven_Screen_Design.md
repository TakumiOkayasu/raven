# 🦅 Raven - 画面設計書

## v0.1.0

**作成日**: 2025-12-25
**対象**: 基本仕様書 v0.4.0

---

## 1. 画面一覧

### 1.1 メイン画面

| 画面ID | 画面名 | 説明 |
|--------|--------|------|
| M-001 | メインウィンドウ | ターミナル操作の主画面 |
| M-002 | タブバー | タブ管理エリア |
| M-003 | ターミナルペイン | ターミナル表示エリア |
| M-004 | ステータスバー | Git/接続状態表示エリア |

### 1.2 パネル(オーバーレイ)

| 画面ID | 画面名 | 説明 |
|--------|--------|------|
| P-001 | クイック接続パネル | SSH/シリアル接続検索 |
| P-002 | Git 操作パネル | Git コマンド実行 |
| P-003 | 検索パネル | 画面内検索 |
| P-004 | マルチライン貼り付け確認 | 複数行ペースト確認 |

### 1.3 設定画面

| 画面ID | 画面名 | 説明 |
|--------|--------|------|
| S-001 | 設定メイン | 設定カテゴリ一覧 |
| S-002 | 一般設定 | 基本動作設定 |
| S-003 | 外観設定 | テーマ、フォント設定 |
| S-004 | 接続設定 | SSH/シリアル接続管理 |
| S-005 | アクセシビリティ設定 | 色覚対応、アイコン表示 |

---

## 2. 画面詳細設計

### 2.1 M-001: メインウィンドウ

#### 2.1.1 ワイヤーフレーム

```
┌─────────────────────────────────────────────────────────────────────────┐
│                              ウィンドウタイトル                           │
├─────────────────────────────────────────────────────────────────────────┤
│ M-002: タブバー                                                          │
│ ┌──────────┐ ┌──────────┐ ┌──────────┐                         ┌───┐   │
│ │ ● ~/dev  │ │ ○ server1│ │ ○ serial │                         │ + │   │
│ └──────────┘ └──────────┘ └──────────┘                         └───┘   │
├─────────────────────────────────────────────────────────────────────────┤
│ M-003: ターミナルペイン                                                   │
│ ┌─────────────────────────────────┬─────────────────────────────────┐   │
│ │                                 │                                 │   │
│ │  Pane 1 (ローカル)              │  Pane 2 (SSH)                   │   │
│ │                                 │                                 │   │
│ │  ~/dev/raven                    │  user@server1:~                 │   │
│ │  $ ls -la                       │  $ htop                         │   │
│ │  total 128                      │                                 │   │
│ │  drwxr-xr-x  12 user  staff ... │  [htop output]                  │   │
│ │                                 │                                 │   │
│ │  $ █                            │                                 │   │
│ │                                 │                                 │   │
│ ├─────────────────────────────────┴─────────────────────────────────┤   │
│ │                                                                   │   │
│ │  Pane 3 (シリアル)                                                 │   │
│ │  /dev/tty.usbserial-1420 @ 115200 8N1                             │   │
│ │  [Timestamp] Received data...                                     │   │
│ │                                                                   │   │
│ └───────────────────────────────────────────────────────────────────┘   │
├─────────────────────────────────────────────────────────────────────────┤
│ M-004: ステータスバー                                                     │
│ ┌────────────────┬────────────────┬────────────────┬──────────────────┐ │
│ │ 🔀 main        │ ↑2 ↓1         │ M:3 U:1        │ SSH: server1     │ │
│ │ (branch)       │ (ahead/behind) │ (changes)      │ (connection)     │ │
│ └────────────────┴────────────────┴────────────────┴──────────────────┘ │
└─────────────────────────────────────────────────────────────────────────┘
```

#### 2.1.2 レイアウト仕様

| 要素 | 高さ | 配置 |
|------|------|------|
| タブバー | 36px 固定 | 上部 |
| ターミナルペイン | 可変(残り) | 中央 |
| ステータスバー | 24px 固定 | 下部 |

#### 2.1.3 最小ウィンドウサイズ

- 幅: 400px
- 高さ: 300px

---

### 2.2 M-002: タブバー

#### 2.2.1 ワイヤーフレーム(詳細)

```
┌─────────────────────────────────────────────────────────────────────────┐
│ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐     ┌───┐  │
│ │ ● ✕ │ ~/dev     │ │ ○   │ server1   │ │ ○   │ serial    │     │ + │  │
│ │ [1]  [2]  [3]   │ │ [4]  [5]  [6]   │ │ [7]  [8]  [9]   │     │[10]│  │
│ └─────────────────┘ └─────────────────┘ └─────────────────┘     └───┘  │
│                                                                        │
│ [1] アクティブインジケーター(●=アクティブ、○=非アクティブ)               │
│ [2] クローズボタン(ホバー時表示)                                         │
│ [3] タブタイトル(パス/ホスト名)                                          │
│ [4]-[9] 同上                                                            │
│ [10] 新規タブボタン                                                      │
└─────────────────────────────────────────────────────────────────────────┘
```

#### 2.2.2 タブ状態

| 状態 | 背景色 | 文字色 | インジケーター |
|------|--------|--------|---------------|
| アクティブ | `tabBar.activeBackground` | `tabBar.activeForeground` | ● (塗りつぶし) |
| 非アクティブ | `tabBar.background` | `tabBar.foreground` | ○ (枠線のみ) |
| ホバー | 10% 明るく | - | - |
| ドラッグ中 | 半透明 | - | - |

#### 2.2.3 タブ操作

| 操作 | アクション |
|------|----------|
| クリック | タブをアクティブに |
| ダブルクリック | タブ名編集モード |
| 中クリック | タブを閉じる |
| ドラッグ | タブ並び替え |
| 右クリック | コンテキストメニュー |

#### 2.2.4 タブコンテキストメニュー

```
┌─────────────────────────┐
│ 新規タブ           ⌘T   │
│ タブを複製              │
│ ─────────────────────── │
│ 名前を変更              │
│ ─────────────────────── │
│ 他のタブを閉じる        │
│ 右側のタブを閉じる      │
│ タブを閉じる       ⌘W   │
└─────────────────────────┘
```

---

### 2.3 M-003: ターミナルペイン

#### 2.3.1 単一ペイン

```
┌─────────────────────────────────────────────────────────────────────────┐
│ ~/dev/raven                                                             │
│ $ git status                                                            │
│ On branch main                                                          │
│ Your branch is ahead of 'origin/main' by 2 commits.                     │
│                                                                         │
│ Changes not staged for commit:                                          │
│   modified:   README.md                                                 │
│   modified:   src/main.swift                                            │
│                                                                         │
│ Untracked files:                                                        │
│   docs/                                                                 │
│                                                                         │
│ $ █                                                                     │
│                                                                         │
│                                                                    ▼    │ ← スクロールバー
└─────────────────────────────────────────────────────────────────────────┘
```

#### 2.3.2 分割ペイン(水平)

```
┌───────────────────────────────┬───────────────────────────────┐
│ Pane 1                        │ Pane 2                        │
│                               │                               │
│ ~/dev/raven                   │ user@server1:~                │
│ $ vim main.swift              │ $ tail -f /var/log/syslog     │
│                               │                               │
│ [vim content]                 │ [log output]                  │
│                               │                               │
└───────────────────────────────┴───────────────────────────────┘
                                ↑
                         ドラッグでリサイズ可能
```

#### 2.3.3 分割ペイン(垂直)

```
┌─────────────────────────────────────────────────────────────────────────┐
│ Pane 1                                                                  │
│                                                                         │
│ ~/dev/raven                                                             │
│ $ make build                                                            │
│ [build output]                                                          │
│                                                                         │
├─────────────────────────────────────────────────────────────────────────┤ ← ドラッグでリサイズ
│ Pane 2                                                                  │
│                                                                         │
│ ~/dev/raven                                                             │
│ $ make test                                                             │
│ [test output]                                                           │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

#### 2.3.4 フォーカス表示

| 状態 | ボーダー色 | 太さ |
|------|-----------|------|
| フォーカスあり | `pane.dividerActive` | 2px |
| フォーカスなし | `pane.divider` | 1px |

---

### 2.4 M-004: ステータスバー

#### 2.4.1 ワイヤーフレーム(詳細)

```
┌─────────────────────────────────────────────────────────────────────────┐
│ ┌─────────────┐ ┌─────────┐ ┌───────────┐ ┌─────────────────┐ ┌───────┐│
│ │🔀 main      │ │↑2 ↓1   │ │M:3 U:1 !0 │ │🔌 server1       │ │115200 ││
│ │   [1]       │ │  [2]   │ │    [3]    │ │     [4]         │ │  [5]  ││
│ └─────────────┘ └─────────┘ └───────────┘ └─────────────────┘ └───────┘│
│                                                                        │
│ [1] Git ブランチ名                                                      │
│ [2] Ahead/Behind (色+アイコン)                                          │
│ [3] 変更ファイル数 (Modified/Untracked/Conflict)                        │
│ [4] SSH 接続状態                                                        │
│ [5] シリアル接続状態(ボーレート)                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

#### 2.4.2 Git ステータス表示(アクセシビリティ対応)

**デフォルトテーマ**:
```
┌─────────────────────────────────────────┐
│  🔀 main   ↑2   ↓1   M:3  U:1  !0      │
│            緑   黄    黄   緑   赤       │
└─────────────────────────────────────────┘
```

**色覚対応テーマ**:
```
┌─────────────────────────────────────────┐
│  🔀 main   ↑2   ↓1   M:3  U:1  !0      │
│            青  橙     橙   青   紫       │
└─────────────────────────────────────────┘
```

**アイコン表示有効時**:
```
┌─────────────────────────────────────────┐
│  🔀 main  ⬆️2  ⬇️1  ✏️3  ➕1  ⚠️0       │
└─────────────────────────────────────────┘
```

#### 2.4.3 接続状態アイコン

| 状態 | アイコン | 色 |
|------|---------|-----|
| SSH 接続中 | 🔌 | 緑/シアン |
| SSH 切断 | 🔌 | グレー |
| シリアル接続中 | 📡 | 緑/シアン |
| シリアル切断 | 📡 | グレー |

---

### 2.5 P-001: クイック接続パネル

#### 2.5.1 ワイヤーフレーム

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│                    ┌─────────────────────────────────┐                  │
│                    │ 🔍 server1                     │                  │
│                    └─────────────────────────────────┘                  │
│                    ┌─────────────────────────────────┐                  │
│                    │ 🔌 SSH                          │                  │
│                    │ ┌─────────────────────────────┐ │                  │
│                    │ │ > server1 (192.168.1.10)   │ │ ← 選択中         │
│                    │ │   server2 (192.168.1.11)   │ │                  │
│                    │ │   production (10.0.0.1)    │ │                  │
│                    │ └─────────────────────────────┘ │                  │
│                    │ 📡 Serial                       │                  │
│                    │ ┌─────────────────────────────┐ │                  │
│                    │ │   /dev/tty.usbserial-1420  │ │                  │
│                    │ │   /dev/tty.usbserial-1421  │ │                  │
│                    │ └─────────────────────────────┘ │                  │
│                    │                                 │                  │
│                    │ [Enter] 接続  [Esc] キャンセル  │                  │
│                    └─────────────────────────────────┘                  │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

#### 2.5.2 操作

| キー | アクション |
|------|----------|
| ↑/↓ | 選択移動 |
| Enter | 接続 |
| Esc | キャンセル |
| Tab | SSH/Serial 切り替え |
| 文字入力 | フィルタリング |

---

### 2.6 P-004: マルチライン貼り付け確認

#### 2.6.1 ワイヤーフレーム

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│           ┌───────────────────────────────────────────────┐             │
│           │  ⚠️ 複数行のテキストを貼り付けようとしています  │             │
│           ├───────────────────────────────────────────────┤             │
│           │                                               │             │
│           │  以下の 3 行が貼り付けられます:                │             │
│           │                                               │             │
│           │  ┌───────────────────────────────────────┐   │             │
│           │  │ cd /var/log                           │   │             │
│           │  │ grep -r "error" .                     │   │             │
│           │  │ rm -rf /tmp/cache                     │   │             │
│           │  └───────────────────────────────────────┘   │             │
│           │                                               │             │
│           │  □ 今後このダイアログを表示しない             │             │
│           │                                               │             │
│           │         ┌──────────┐  ┌──────────┐           │             │
│           │         │キャンセル │  │ 貼り付け │           │             │
│           │         └──────────┘  └──────────┘           │             │
│           └───────────────────────────────────────────────┘             │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

#### 2.6.2 要素仕様

| 要素 | 仕様 |
|------|------|
| プレビュー領域 | 最大10行表示、それ以上は省略 |
| 危険コマンド検出 | `rm -rf`, `sudo`, `mkfs` 等は赤字で警告 |
| チェックボックス | 設定に保存される |

---

### 2.7 S-003: 外観設定

#### 2.7.1 ワイヤーフレーム

```
┌─────────────────────────────────────────────────────────────────────────┐
│ ←  外観設定                                                             │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  テーマ                                                                 │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ 🌙 ダーク                                                    ✓ │   │
│  │ ☀️ ライト                                                      │   │
│  │ 🖥️ システムに合わせる                                          │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  カラーテーマ                                                           │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ Default Dark                                                 ▼ │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│  ├── Default Dark                                                      │
│  ├── Default Light                                                     │
│  ├── Colorblind Dark  ♿                                                │
│  ├── Colorblind Light ♿                                                │
│  ├── Solarized Dark                                                    │
│  └── [テーマフォルダを開く...]                                          │
│                                                                         │
│  フォント                                                               │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ Menlo                                                        ▼ │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  フォントサイズ                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ ◀──────────────●──────────────▶   14 pt                        │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  □ リガチャを有効にする (Fira Code などで有効)                          │
│                                                                         │
│  プレビュー                                                             │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ ~/dev $ ls -la                                                  │   │
│  │ total 128                                                       │   │
│  │ -rw-r--r--  1 user  staff  1234 Dec 25 README.md               │   │
│  │ $ echo "Hello, Raven!"                                          │   │
│  │ Hello, Raven!                                                   │   │
│  │ $ █                                                             │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

### 2.8 S-005: アクセシビリティ設定

#### 2.8.1 ワイヤーフレーム

```
┌─────────────────────────────────────────────────────────────────────────┐
│ ←  アクセシビリティ                                                      │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  色覚サポート                                                           │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                                                                 │   │
│  │  ☑ 色覚多様性対応カラーを使用                                    │   │
│  │                                                                 │   │
│  │  このオプションを有効にすると、赤緑色覚異常(色盲・色弱)の方      │   │
│  │  でも見分けやすい配色に変更されます。                            │   │
│  │                                                                 │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  アイコン表示                                                           │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                                                                 │   │
│  │  ☑ ステータス表示にアイコンを使用                                │   │
│  │                                                                 │   │
│  │  色だけでなくアイコン(↑↓!など)でも状態を表示します。            │   │
│  │  色覚に関係なく、より直感的に状態を把握できます。                │   │
│  │                                                                 │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  プレビュー                                                             │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                                                                 │   │
│  │  Git ステータス表示:                                             │   │
│  │                                                                 │   │
│  │  通常:    main  ↑2  ↓1  M:3  U:1  !0                           │   │
│  │                  ■   ■    ■    ■    ■                           │   │
│  │                 青  橙   橙   青   紫                            │   │
│  │                                                                 │   │
│  │  セマンティック:                                                 │   │
│  │  ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐                              │   │
│  │  │✓成功│ │⚠警告│ │✗エラー│ │ℹ情報│                              │   │
│  │  └─────┘ └─────┘ └─────┘ └─────┘                              │   │
│  │                                                                 │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 3. 画面遷移図

### 3.1 メイン画面からの遷移

```
                          ┌──────────────────┐
                          │  M-001           │
                          │  メインウィンドウ │
                          └────────┬─────────┘
                                   │
           ┌───────────────────────┼───────────────────────┐
           │                       │                       │
           ▼                       ▼                       ▼
┌──────────────────┐    ┌──────────────────┐    ┌──────────────────┐
│  P-001           │    │  P-002           │    │  P-003           │
│  クイック接続    │    │  Git パネル      │    │  検索パネル      │
│  (Cmd+K)         │    │  (Cmd+G)         │    │  (Cmd+F)         │
└──────────────────┘    └──────────────────┘    └──────────────────┘
           │
           │ 接続選択
           ▼
┌──────────────────┐
│  新規タブ/ペイン │
│  (SSH/Serial)    │
└──────────────────┘
```

### 3.2 設定画面の遷移

```
┌──────────────────┐
│  S-001           │
│  設定メイン      │
│  (Cmd+,)         │
└────────┬─────────┘
         │
         ├──────────────────────────────────────────────────┐
         │                │                │                │
         ▼                ▼                ▼                ▼
┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐
│  S-002      │  │  S-003      │  │  S-004      │  │  S-005      │
│  一般       │  │  外観       │  │  接続       │  │アクセシビリティ│
└─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘
                       │
                       ▼
              ┌─────────────────┐
              │ テーマファイル  │
              │ 選択ダイアログ  │
              └─────────────────┘
```

---

## 4. コンポーネント仕様

### 4.1 共通コンポーネント

#### 4.1.1 RavenButton

```swift
struct RavenButton: View {
    enum Style {
        case primary    // 青背景、白文字
        case secondary  // 枠線のみ
        case danger     // 赤背景
    }
    
    let title: String
    let style: Style
    let action: () -> Void
}
```

**サイズ**:
- 高さ: 32px
- パディング: 水平 16px
- 角丸: 6px

#### 4.1.2 RavenTextField

```swift
struct RavenTextField: View {
    let placeholder: String
    @Binding var text: String
    let icon: String?  // SF Symbol
}
```

**サイズ**:
- 高さ: 36px
- パディング: 水平 12px
- 角丸: 8px

#### 4.1.3 GitStatusBadge

```swift
struct GitStatusBadge: View {
    let status: GitStatusType
    let count: Int
    let showIcon: Bool
}
```

**表示形式**:
- アイコン表示: `⬆️2` (アイコン + 数字)
- テキスト表示: `↑2` (テキスト + 数字)

---

## 5. レスポンシブ対応

### 5.1 ウィンドウサイズ別レイアウト

| サイズ | 幅 | タブバー | ステータスバー |
|--------|-----|---------|---------------|
| コンパクト | 400-600px | アイコンのみ | 省略表示 |
| 標準 | 600-1200px | タイトル表示 | 完全表示 |
| ワイド | 1200px+ | タイトル + パス | 完全表示 + 追加情報 |

### 5.2 ステータスバー省略ルール

```
ワイド (1200px+):
  🔀 main (feature/abc)  ↑2 ↓1  M:3 U:1 !0  🔌 server1  📡 115200

標準 (600-1200px):
  🔀 main  ↑2 ↓1  M:3 U:1  🔌 server1

コンパクト (400-600px):
  main  ↑2↓1  M:3  🔌
```

---

## 6. アニメーション仕様

### 6.1 パネル表示

| 要素 | アニメーション | 時間 |
|------|--------------|------|
| クイック接続パネル | フェードイン + スケール(0.95→1.0) | 150ms |
| 検索パネル | スライドダウン | 200ms |
| 確認ダイアログ | フェードイン | 150ms |

### 6.2 タブ操作

| 操作 | アニメーション | 時間 |
|------|--------------|------|
| タブ追加 | 右からスライドイン | 200ms |
| タブ削除 | 左へスライドアウト + フェード | 200ms |
| タブ並び替え | スプリングアニメーション | 300ms |

### 6.3 スクロール

| 要素 | アニメーション | 時間 |
|------|--------------|------|
| スムーズスクロール | イージング(easeOut) | 100ms |
| 検索ジャンプ | スプリング | 200ms |

---

## 7. 改訂履歴

| バージョン | 日付 | 内容 |
|-----------|------|------|
| 0.1.0 | 2025-12-25 | 初版作成。メイン画面、パネル、設定画面、コンポーネント仕様 |

---

**以上**
